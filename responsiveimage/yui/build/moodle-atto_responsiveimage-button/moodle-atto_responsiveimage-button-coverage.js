
var __cov_KvEaIzhEyUKJ2_d3Ygivgg = (Function('return this'))();
if (!__cov_KvEaIzhEyUKJ2_d3Ygivgg.__coverage__) { __cov_KvEaIzhEyUKJ2_d3Ygivgg.__coverage__ = {}; }
__cov_KvEaIzhEyUKJ2_d3Ygivgg = __cov_KvEaIzhEyUKJ2_d3Ygivgg.__coverage__;
if (!(__cov_KvEaIzhEyUKJ2_d3Ygivgg['build/moodle-atto_responsiveimage-button/moodle-atto_responsiveimage-button.js'])) {
   __cov_KvEaIzhEyUKJ2_d3Ygivgg['build/moodle-atto_responsiveimage-button/moodle-atto_responsiveimage-button.js'] = {"path":"build/moodle-atto_responsiveimage-button/moodle-atto_responsiveimage-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0},"b":{"1":[0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":46},"end":{"line":1,"column":65}}},"2":{"name":"(anonymous_2)","line":166,"loc":{"start":{"line":166,"column":15},"end":{"line":166,"column":26}}},"3":{"name":"(anonymous_3)","line":179,"loc":{"start":{"line":179,"column":31},"end":{"line":179,"column":43}}},"4":{"name":"(anonymous_4)","line":182,"loc":{"start":{"line":182,"column":32},"end":{"line":182,"column":44}}},"5":{"name":"(anonymous_5)","line":195,"loc":{"start":{"line":195,"column":19},"end":{"line":195,"column":31}}},"6":{"name":"(anonymous_6)","line":249,"loc":{"start":{"line":249,"column":33},"end":{"line":249,"column":44}}},"7":{"name":"(anonymous_7)","line":289,"loc":{"start":{"line":289,"column":60},"end":{"line":289,"column":71}}},"8":{"name":"(anonymous_8)","line":312,"loc":{"start":{"line":312,"column":16},"end":{"line":312,"column":28}}},"9":{"name":"(anonymous_9)","line":327,"loc":{"start":{"line":327,"column":20},"end":{"line":327,"column":31}}},"10":{"name":"(anonymous_10)","line":357,"loc":{"start":{"line":357,"column":21},"end":{"line":357,"column":35}}},"11":{"name":"(anonymous_11)","line":361,"loc":{"start":{"line":361,"column":20},"end":{"line":361,"column":31}}},"12":{"name":"(anonymous_12)","line":371,"loc":{"start":{"line":371,"column":19},"end":{"line":371,"column":30}}},"13":{"name":"(anonymous_13)","line":399,"loc":{"start":{"line":399,"column":23},"end":{"line":399,"column":34}}},"14":{"name":"(anonymous_14)","line":420,"loc":{"start":{"line":420,"column":36},"end":{"line":420,"column":48}}},"15":{"name":"(anonymous_15)","line":438,"loc":{"start":{"line":438,"column":23},"end":{"line":438,"column":40}}},"16":{"name":"(anonymous_16)","line":456,"loc":{"start":{"line":456,"column":30},"end":{"line":456,"column":48}}},"17":{"name":"(anonymous_17)","line":457,"loc":{"start":{"line":457,"column":17},"end":{"line":457,"column":34}}},"18":{"name":"(anonymous_18)","line":465,"loc":{"start":{"line":465,"column":34},"end":{"line":465,"column":45}}},"19":{"name":"(anonymous_19)","line":472,"loc":{"start":{"line":472,"column":33},"end":{"line":472,"column":44}}},"20":{"name":"(anonymous_20)","line":495,"loc":{"start":{"line":495,"column":25},"end":{"line":495,"column":40}}},"21":{"name":"(anonymous_21)","line":502,"loc":{"start":{"line":502,"column":24},"end":{"line":502,"column":44}}},"22":{"name":"(anonymous_22)","line":536,"loc":{"start":{"line":536,"column":31},"end":{"line":536,"column":42}}},"23":{"name":"(anonymous_23)","line":579,"loc":{"start":{"line":579,"column":26},"end":{"line":579,"column":54}}},"24":{"name":"(anonymous_24)","line":584,"loc":{"start":{"line":584,"column":31},"end":{"line":584,"column":51}}},"25":{"name":"(anonymous_25)","line":611,"loc":{"start":{"line":611,"column":15},"end":{"line":611,"column":26}}},"26":{"name":"(anonymous_26)","line":627,"loc":{"start":{"line":627,"column":13},"end":{"line":627,"column":25}}},"27":{"name":"(anonymous_27)","line":681,"loc":{"start":{"line":681,"column":26},"end":{"line":681,"column":46}}},"28":{"name":"(anonymous_28)","line":687,"loc":{"start":{"line":687,"column":20},"end":{"line":687,"column":40}}},"29":{"name":"(anonymous_29)","line":710,"loc":{"start":{"line":710,"column":22},"end":{"line":710,"column":42}}},"30":{"name":"(anonymous_30)","line":721,"loc":{"start":{"line":721,"column":18},"end":{"line":721,"column":29}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":727,"column":61}},"2":{"start":{"line":36,"column":0},"end":{"line":126,"column":21}},"3":{"start":{"line":128,"column":2},"end":{"line":724,"column":5}},"4":{"start":{"line":168,"column":4},"end":{"line":173,"column":7}},"5":{"start":{"line":174,"column":4},"end":{"line":174,"column":90}},"6":{"start":{"line":175,"column":4},"end":{"line":175,"column":83}},"7":{"start":{"line":176,"column":4},"end":{"line":176,"column":55}},"8":{"start":{"line":179,"column":4},"end":{"line":181,"column":13}},"9":{"start":{"line":180,"column":8},"end":{"line":180,"column":27}},"10":{"start":{"line":182,"column":4},"end":{"line":184,"column":13}},"11":{"start":{"line":183,"column":8},"end":{"line":183,"column":27}},"12":{"start":{"line":197,"column":4},"end":{"line":199,"column":55}},"13":{"start":{"line":201,"column":4},"end":{"line":201,"column":25}},"14":{"start":{"line":202,"column":4},"end":{"line":202,"column":17}},"15":{"start":{"line":205,"column":4},"end":{"line":205,"column":102}},"16":{"start":{"line":206,"column":4},"end":{"line":301,"column":5}},"17":{"start":{"line":208,"column":8},"end":{"line":215,"column":53}},"18":{"start":{"line":217,"column":8},"end":{"line":217,"column":27}},"19":{"start":{"line":218,"column":8},"end":{"line":218,"column":28}},"20":{"start":{"line":219,"column":8},"end":{"line":219,"column":69}},"21":{"start":{"line":220,"column":8},"end":{"line":220,"column":50}},"22":{"start":{"line":223,"column":8},"end":{"line":228,"column":9}},"23":{"start":{"line":224,"column":12},"end":{"line":227,"column":13}},"24":{"start":{"line":225,"column":16},"end":{"line":225,"column":77}},"25":{"start":{"line":226,"column":16},"end":{"line":226,"column":22}},"26":{"start":{"line":229,"column":8},"end":{"line":229,"column":44}},"27":{"start":{"line":230,"column":8},"end":{"line":230,"column":50}},"28":{"start":{"line":231,"column":8},"end":{"line":231,"column":56}},"29":{"start":{"line":232,"column":8},"end":{"line":232,"column":46}},"30":{"start":{"line":233,"column":8},"end":{"line":233,"column":54}},"31":{"start":{"line":236,"column":8},"end":{"line":236,"column":41}},"32":{"start":{"line":237,"column":8},"end":{"line":237,"column":89}},"33":{"start":{"line":238,"column":8},"end":{"line":238,"column":21}},"34":{"start":{"line":239,"column":8},"end":{"line":239,"column":32}},"35":{"start":{"line":240,"column":8},"end":{"line":244,"column":11}},"36":{"start":{"line":245,"column":8},"end":{"line":245,"column":50}},"37":{"start":{"line":246,"column":8},"end":{"line":246,"column":27}},"38":{"start":{"line":249,"column":8},"end":{"line":297,"column":10}},"39":{"start":{"line":250,"column":12},"end":{"line":254,"column":25}},"40":{"start":{"line":256,"column":12},"end":{"line":296,"column":13}},"41":{"start":{"line":257,"column":16},"end":{"line":295,"column":17}},"42":{"start":{"line":258,"column":20},"end":{"line":258,"column":58}},"43":{"start":{"line":259,"column":20},"end":{"line":287,"column":21}},"44":{"start":{"line":260,"column":24},"end":{"line":265,"column":25}},"45":{"start":{"line":261,"column":28},"end":{"line":263,"column":29}},"46":{"start":{"line":262,"column":32},"end":{"line":262,"column":57}},"47":{"start":{"line":264,"column":28},"end":{"line":264,"column":68}},"48":{"start":{"line":267,"column":24},"end":{"line":267,"column":38}},"49":{"start":{"line":268,"column":24},"end":{"line":273,"column":25}},"50":{"start":{"line":272,"column":28},"end":{"line":272,"column":50}},"51":{"start":{"line":276,"column":24},"end":{"line":279,"column":27}},"52":{"start":{"line":280,"column":24},"end":{"line":280,"column":58}},"53":{"start":{"line":281,"column":24},"end":{"line":285,"column":25}},"54":{"start":{"line":282,"column":28},"end":{"line":282,"column":58}},"55":{"start":{"line":284,"column":28},"end":{"line":284,"column":62}},"56":{"start":{"line":286,"column":24},"end":{"line":286,"column":43}},"57":{"start":{"line":289,"column":20},"end":{"line":291,"column":23}},"58":{"start":{"line":290,"column":24},"end":{"line":290,"column":96}},"59":{"start":{"line":292,"column":20},"end":{"line":294,"column":21}},"60":{"start":{"line":293,"column":24},"end":{"line":293,"column":49}},"61":{"start":{"line":298,"column":8},"end":{"line":298,"column":96}},"62":{"start":{"line":299,"column":8},"end":{"line":299,"column":27}},"63":{"start":{"line":300,"column":8},"end":{"line":300,"column":21}},"64":{"start":{"line":313,"column":4},"end":{"line":313,"column":25}},"65":{"start":{"line":315,"column":4},"end":{"line":315,"column":65}},"66":{"start":{"line":316,"column":4},"end":{"line":318,"column":5}},"67":{"start":{"line":317,"column":8},"end":{"line":317,"column":49}},"68":{"start":{"line":329,"column":4},"end":{"line":329,"column":61}},"69":{"start":{"line":330,"column":4},"end":{"line":332,"column":5}},"70":{"start":{"line":331,"column":8},"end":{"line":331,"column":15}},"71":{"start":{"line":335,"column":4},"end":{"line":335,"column":36}},"72":{"start":{"line":337,"column":4},"end":{"line":342,"column":7}},"73":{"start":{"line":345,"column":4},"end":{"line":346,"column":20}},"74":{"start":{"line":358,"column":4},"end":{"line":358,"column":28}},"75":{"start":{"line":359,"column":4},"end":{"line":359,"column":20}},"76":{"start":{"line":361,"column":4},"end":{"line":369,"column":6}},"77":{"start":{"line":362,"column":8},"end":{"line":362,"column":65}},"78":{"start":{"line":363,"column":8},"end":{"line":365,"column":11}},"79":{"start":{"line":368,"column":8},"end":{"line":368,"column":44}},"80":{"start":{"line":371,"column":4},"end":{"line":386,"column":6}},"81":{"start":{"line":372,"column":8},"end":{"line":372,"column":72}},"82":{"start":{"line":374,"column":8},"end":{"line":377,"column":10}},"83":{"start":{"line":379,"column":8},"end":{"line":379,"column":59}},"84":{"start":{"line":380,"column":8},"end":{"line":380,"column":44}},"85":{"start":{"line":381,"column":8},"end":{"line":383,"column":11}},"86":{"start":{"line":385,"column":8},"end":{"line":385,"column":44}},"87":{"start":{"line":388,"column":4},"end":{"line":388,"column":20}},"88":{"start":{"line":400,"column":4},"end":{"line":408,"column":12}},"89":{"start":{"line":410,"column":4},"end":{"line":410,"column":29}},"90":{"start":{"line":413,"column":4},"end":{"line":413,"column":47}},"91":{"start":{"line":415,"column":4},"end":{"line":415,"column":78}},"92":{"start":{"line":416,"column":4},"end":{"line":416,"column":78}},"93":{"start":{"line":417,"column":4},"end":{"line":417,"column":80}},"94":{"start":{"line":419,"column":5},"end":{"line":425,"column":6}},"95":{"start":{"line":420,"column":10},"end":{"line":424,"column":61}},"96":{"start":{"line":421,"column":14},"end":{"line":421,"column":43}},"97":{"start":{"line":422,"column":14},"end":{"line":422,"column":33}},"98":{"start":{"line":423,"column":14},"end":{"line":423,"column":99}},"99":{"start":{"line":427,"column":4},"end":{"line":427,"column":19}},"100":{"start":{"line":439,"column":4},"end":{"line":445,"column":5}},"101":{"start":{"line":440,"column":8},"end":{"line":440,"column":59}},"102":{"start":{"line":441,"column":8},"end":{"line":441,"column":39}},"103":{"start":{"line":444,"column":8},"end":{"line":444,"column":43}},"104":{"start":{"line":457,"column":10},"end":{"line":485,"column":12}},"105":{"start":{"line":458,"column":14},"end":{"line":484,"column":15}},"106":{"start":{"line":459,"column":18},"end":{"line":459,"column":62}},"107":{"start":{"line":460,"column":18},"end":{"line":460,"column":49}},"108":{"start":{"line":463,"column":18},"end":{"line":463,"column":42}},"109":{"start":{"line":465,"column":18},"end":{"line":470,"column":20}},"110":{"start":{"line":466,"column":22},"end":{"line":466,"column":72}},"111":{"start":{"line":467,"column":22},"end":{"line":469,"column":25}},"112":{"start":{"line":472,"column":18},"end":{"line":481,"column":20}},"113":{"start":{"line":473,"column":22},"end":{"line":473,"column":32}},"114":{"start":{"line":475,"column":22},"end":{"line":475,"column":66}},"115":{"start":{"line":476,"column":22},"end":{"line":476,"column":58}},"116":{"start":{"line":477,"column":22},"end":{"line":479,"column":25}},"117":{"start":{"line":483,"column":18},"end":{"line":483,"column":41}},"118":{"start":{"line":496,"column":4},"end":{"line":497,"column":47}},"119":{"start":{"line":499,"column":4},"end":{"line":512,"column":5}},"120":{"start":{"line":500,"column":8},"end":{"line":500,"column":40}},"121":{"start":{"line":502,"column":8},"end":{"line":509,"column":17}},"122":{"start":{"line":503,"column":12},"end":{"line":506,"column":13}},"123":{"start":{"line":505,"column":16},"end":{"line":505,"column":28}},"124":{"start":{"line":508,"column":12},"end":{"line":508,"column":25}},"125":{"start":{"line":511,"column":8},"end":{"line":511,"column":15}},"126":{"start":{"line":514,"column":4},"end":{"line":516,"column":5}},"127":{"start":{"line":515,"column":8},"end":{"line":515,"column":74}},"128":{"start":{"line":517,"column":4},"end":{"line":519,"column":5}},"129":{"start":{"line":518,"column":8},"end":{"line":518,"column":82}},"130":{"start":{"line":521,"column":4},"end":{"line":524,"column":5}},"131":{"start":{"line":522,"column":8},"end":{"line":522,"column":66}},"132":{"start":{"line":523,"column":8},"end":{"line":523,"column":47}},"133":{"start":{"line":537,"column":4},"end":{"line":547,"column":14}},"134":{"start":{"line":549,"column":4},"end":{"line":551,"column":5}},"135":{"start":{"line":550,"column":8},"end":{"line":550,"column":38}},"136":{"start":{"line":553,"column":4},"end":{"line":564,"column":5}},"137":{"start":{"line":554,"column":8},"end":{"line":554,"column":60}},"138":{"start":{"line":555,"column":8},"end":{"line":555,"column":36}},"139":{"start":{"line":557,"column":8},"end":{"line":557,"column":44}},"140":{"start":{"line":558,"column":8},"end":{"line":558,"column":39}},"141":{"start":{"line":560,"column":8},"end":{"line":560,"column":55}},"142":{"start":{"line":561,"column":8},"end":{"line":561,"column":51}},"143":{"start":{"line":562,"column":8},"end":{"line":562,"column":73}},"144":{"start":{"line":563,"column":8},"end":{"line":563,"column":26}},"145":{"start":{"line":567,"column":4},"end":{"line":567,"column":31}},"146":{"start":{"line":568,"column":4},"end":{"line":568,"column":17}},"147":{"start":{"line":580,"column":4},"end":{"line":581,"column":25}},"148":{"start":{"line":584,"column":4},"end":{"line":597,"column":13}},"149":{"start":{"line":585,"column":8},"end":{"line":585,"column":65}},"150":{"start":{"line":586,"column":8},"end":{"line":590,"column":9}},"151":{"start":{"line":587,"column":12},"end":{"line":587,"column":47}},"152":{"start":{"line":589,"column":12},"end":{"line":589,"column":24}},"153":{"start":{"line":592,"column":8},"end":{"line":594,"column":9}},"154":{"start":{"line":593,"column":12},"end":{"line":593,"column":47}},"155":{"start":{"line":596,"column":8},"end":{"line":596,"column":21}},"156":{"start":{"line":599,"column":4},"end":{"line":601,"column":5}},"157":{"start":{"line":600,"column":8},"end":{"line":600,"column":44}},"158":{"start":{"line":612,"column":4},"end":{"line":612,"column":55}},"159":{"start":{"line":614,"column":4},"end":{"line":617,"column":5}},"160":{"start":{"line":616,"column":8},"end":{"line":616,"column":51}},"161":{"start":{"line":628,"column":4},"end":{"line":634,"column":32}},"162":{"start":{"line":636,"column":4},"end":{"line":636,"column":23}},"163":{"start":{"line":639,"column":4},"end":{"line":641,"column":5}},"164":{"start":{"line":640,"column":8},"end":{"line":640,"column":15}},"165":{"start":{"line":644,"column":4},"end":{"line":644,"column":17}},"166":{"start":{"line":645,"column":4},"end":{"line":665,"column":5}},"167":{"start":{"line":646,"column":8},"end":{"line":650,"column":9}},"168":{"start":{"line":647,"column":12},"end":{"line":647,"column":78}},"169":{"start":{"line":649,"column":12},"end":{"line":649,"column":54}},"170":{"start":{"line":653,"column":8},"end":{"line":653,"column":34}},"171":{"start":{"line":655,"column":8},"end":{"line":655,"column":59}},"172":{"start":{"line":656,"column":8},"end":{"line":660,"column":11}},"173":{"start":{"line":662,"column":8},"end":{"line":662,"column":62}},"174":{"start":{"line":664,"column":8},"end":{"line":664,"column":27}},"175":{"start":{"line":667,"column":4},"end":{"line":669,"column":14}},"176":{"start":{"line":682,"column":4},"end":{"line":685,"column":5}},"177":{"start":{"line":684,"column":8},"end":{"line":684,"column":25}},"178":{"start":{"line":687,"column":4},"end":{"line":705,"column":13}},"179":{"start":{"line":688,"column":8},"end":{"line":691,"column":9}},"180":{"start":{"line":690,"column":12},"end":{"line":690,"column":25}},"181":{"start":{"line":693,"column":8},"end":{"line":693,"column":52}},"182":{"start":{"line":694,"column":8},"end":{"line":694,"column":60}},"183":{"start":{"line":695,"column":8},"end":{"line":698,"column":9}},"184":{"start":{"line":697,"column":12},"end":{"line":697,"column":25}},"185":{"start":{"line":700,"column":8},"end":{"line":700,"column":69}},"186":{"start":{"line":701,"column":8},"end":{"line":701,"column":49}},"187":{"start":{"line":702,"column":8},"end":{"line":702,"column":43}},"188":{"start":{"line":704,"column":8},"end":{"line":704,"column":20}},"189":{"start":{"line":707,"column":4},"end":{"line":707,"column":21}},"190":{"start":{"line":711,"column":4},"end":{"line":711,"column":47}},"191":{"start":{"line":722,"column":10},"end":{"line":722,"column":23}}},"branchMap":{"1":{"line":205,"type":"binary-expr","locations":[{"start":{"line":205,"column":31},"end":{"line":205,"column":45}},{"start":{"line":205,"column":49},"end":{"line":205,"column":69}},{"start":{"line":205,"column":73},"end":{"line":205,"column":100}}]},"2":{"line":206,"type":"if","locations":[{"start":{"line":206,"column":4},"end":{"line":206,"column":4}},{"start":{"line":206,"column":4},"end":{"line":206,"column":4}}]},"3":{"line":206,"type":"binary-expr","locations":[{"start":{"line":206,"column":8},"end":{"line":206,"column":27}},{"start":{"line":206,"column":31},"end":{"line":206,"column":76}}]},"4":{"line":209,"type":"cond-expr","locations":[{"start":{"line":209,"column":58},"end":{"line":209,"column":61}},{"start":{"line":209,"column":64},"end":{"line":209,"column":80}}]},"5":{"line":224,"type":"if","locations":[{"start":{"line":224,"column":12},"end":{"line":224,"column":12}},{"start":{"line":224,"column":12},"end":{"line":224,"column":12}}]},"6":{"line":256,"type":"if","locations":[{"start":{"line":256,"column":12},"end":{"line":256,"column":12}},{"start":{"line":256,"column":12},"end":{"line":256,"column":12}}]},"7":{"line":257,"type":"if","locations":[{"start":{"line":257,"column":16},"end":{"line":257,"column":16}},{"start":{"line":257,"column":16},"end":{"line":257,"column":16}}]},"8":{"line":259,"type":"if","locations":[{"start":{"line":259,"column":20},"end":{"line":259,"column":20}},{"start":{"line":259,"column":20},"end":{"line":259,"column":20}}]},"9":{"line":260,"type":"if","locations":[{"start":{"line":260,"column":24},"end":{"line":260,"column":24}},{"start":{"line":260,"column":24},"end":{"line":260,"column":24}}]},"10":{"line":261,"type":"if","locations":[{"start":{"line":261,"column":28},"end":{"line":261,"column":28}},{"start":{"line":261,"column":28},"end":{"line":261,"column":28}}]},"11":{"line":268,"type":"if","locations":[{"start":{"line":268,"column":24},"end":{"line":268,"column":24}},{"start":{"line":268,"column":24},"end":{"line":268,"column":24}}]},"12":{"line":268,"type":"binary-expr","locations":[{"start":{"line":268,"column":28},"end":{"line":268,"column":40}},{"start":{"line":268,"column":44},"end":{"line":268,"column":73}}]},"13":{"line":281,"type":"if","locations":[{"start":{"line":281,"column":24},"end":{"line":281,"column":24}},{"start":{"line":281,"column":24},"end":{"line":281,"column":24}}]},"14":{"line":292,"type":"if","locations":[{"start":{"line":292,"column":20},"end":{"line":292,"column":20}},{"start":{"line":292,"column":20},"end":{"line":292,"column":20}}]},"15":{"line":316,"type":"if","locations":[{"start":{"line":316,"column":4},"end":{"line":316,"column":4}},{"start":{"line":316,"column":4},"end":{"line":316,"column":4}}]},"16":{"line":330,"type":"if","locations":[{"start":{"line":330,"column":4},"end":{"line":330,"column":4}},{"start":{"line":330,"column":4},"end":{"line":330,"column":4}}]},"17":{"line":419,"type":"if","locations":[{"start":{"line":419,"column":5},"end":{"line":419,"column":5}},{"start":{"line":419,"column":5},"end":{"line":419,"column":5}}]},"18":{"line":439,"type":"if","locations":[{"start":{"line":439,"column":4},"end":{"line":439,"column":4}},{"start":{"line":439,"column":4},"end":{"line":439,"column":4}}]},"19":{"line":458,"type":"if","locations":[{"start":{"line":458,"column":14},"end":{"line":458,"column":14}},{"start":{"line":458,"column":14},"end":{"line":458,"column":14}}]},"20":{"line":499,"type":"if","locations":[{"start":{"line":499,"column":4},"end":{"line":499,"column":4}},{"start":{"line":499,"column":4},"end":{"line":499,"column":4}}]},"21":{"line":503,"type":"if","locations":[{"start":{"line":503,"column":12},"end":{"line":503,"column":12}},{"start":{"line":503,"column":12},"end":{"line":503,"column":12}}]},"22":{"line":514,"type":"if","locations":[{"start":{"line":514,"column":4},"end":{"line":514,"column":4}},{"start":{"line":514,"column":4},"end":{"line":514,"column":4}}]},"23":{"line":517,"type":"if","locations":[{"start":{"line":517,"column":4},"end":{"line":517,"column":4}},{"start":{"line":517,"column":4},"end":{"line":517,"column":4}}]},"24":{"line":521,"type":"if","locations":[{"start":{"line":521,"column":4},"end":{"line":521,"column":4}},{"start":{"line":521,"column":4},"end":{"line":521,"column":4}}]},"25":{"line":549,"type":"if","locations":[{"start":{"line":549,"column":4},"end":{"line":549,"column":4}},{"start":{"line":549,"column":4},"end":{"line":549,"column":4}}]},"26":{"line":553,"type":"if","locations":[{"start":{"line":553,"column":4},"end":{"line":553,"column":4}},{"start":{"line":553,"column":4},"end":{"line":553,"column":4}}]},"27":{"line":553,"type":"binary-expr","locations":[{"start":{"line":553,"column":8},"end":{"line":553,"column":14}},{"start":{"line":553,"column":18},"end":{"line":553,"column":31}}]},"28":{"line":586,"type":"if","locations":[{"start":{"line":586,"column":8},"end":{"line":586,"column":8}},{"start":{"line":586,"column":8},"end":{"line":586,"column":8}}]},"29":{"line":592,"type":"if","locations":[{"start":{"line":592,"column":8},"end":{"line":592,"column":8}},{"start":{"line":592,"column":8},"end":{"line":592,"column":8}}]},"30":{"line":599,"type":"if","locations":[{"start":{"line":599,"column":4},"end":{"line":599,"column":4}},{"start":{"line":599,"column":4},"end":{"line":599,"column":4}}]},"31":{"line":599,"type":"binary-expr","locations":[{"start":{"line":599,"column":8},"end":{"line":599,"column":17}},{"start":{"line":599,"column":21},"end":{"line":599,"column":37}}]},"32":{"line":614,"type":"if","locations":[{"start":{"line":614,"column":4},"end":{"line":614,"column":4}},{"start":{"line":614,"column":4},"end":{"line":614,"column":4}}]},"33":{"line":639,"type":"if","locations":[{"start":{"line":639,"column":4},"end":{"line":639,"column":4}},{"start":{"line":639,"column":4},"end":{"line":639,"column":4}}]},"34":{"line":645,"type":"if","locations":[{"start":{"line":645,"column":4},"end":{"line":645,"column":4}},{"start":{"line":645,"column":4},"end":{"line":645,"column":4}}]},"35":{"line":646,"type":"if","locations":[{"start":{"line":646,"column":8},"end":{"line":646,"column":8}},{"start":{"line":646,"column":8},"end":{"line":646,"column":8}}]},"36":{"line":682,"type":"if","locations":[{"start":{"line":682,"column":4},"end":{"line":682,"column":4}},{"start":{"line":682,"column":4},"end":{"line":682,"column":4}}]},"37":{"line":688,"type":"if","locations":[{"start":{"line":688,"column":8},"end":{"line":688,"column":8}},{"start":{"line":688,"column":8},"end":{"line":688,"column":8}}]},"38":{"line":695,"type":"if","locations":[{"start":{"line":695,"column":8},"end":{"line":695,"column":8}},{"start":{"line":695,"column":8},"end":{"line":695,"column":8}}]}},"code":["(function () { YUI.add('moodle-atto_responsiveimage-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/*"," * @package    atto_responsiveimage"," * @copyright  2013 Damyon Wiese  <damyon@moodle.com>"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_responsiveimage_alignment-button"," */","","/**"," * Atto image selection tool."," *"," * @namespace M.atto_responsiveimage"," * @class Button"," * @extends M.editor_atto.EditorPlugin"," */","","var CSS = {","    RESPONSIVE: 'img-responsive',","    INPUTALIGNMENT: 'atto_responsiveimage_alignment',","    INPUTALT: 'atto_responsiveimage_altentry',","    INPUTHEIGHT: 'atto_responsiveimage_heightentry',","    INPUTSUBMIT: 'atto_responsiveimage_urlentrysubmit',","    INPUTURL: 'atto_responsiveimage_urlentry',","    INPUTSIZE: 'atto_responsiveimage_size',","    INPUTWIDTH: 'atto_responsiveimage_widthentry',","    IMAGEALTWARNING: 'atto_responsiveimage_altwarning',","    IMAGEBROWSER: 'atto_responsiveimage_openimagebrowser',","    IMAGEPRESENTATION: 'atto_responsiveimage_presentation',","    INPUTCONSTRAIN: 'atto_responsiveimage_constrain',","    INPUTCUSTOMSTYLE: 'atto_responsiveimage_customstyle',","    IMAGEPREVIEW: 'atto_responsiveimage_preview',","    IMAGEPREVIEWBOX: 'atto_responsiveimage_preview_box',","    ALIGNSETTINGS: 'atto_responsiveimage_button'","  },","  SELECTORS = {","    INPUTURL: '.' + CSS.INPUTURL","  },","  ALIGNMENTS = [","    // Vertical alignment.","    {","        name: 'verticalAlign',","        str: 'alignment_top',","        value: 'text-top',","        margin: '0 0.5em'","    }","  ],","  ","  REGEX = {","    ISPERCENT: /\\d+%/","  },","  ","  COMPONENTNAME = 'atto_responsiveimage',","  ","  TEMPLATE = '' +","        '<form class=\"atto_attoform\">' +","  ","            // Add the repository browser button.","            '{{#if showFilepicker}}' +","                '<div class=\"mb-1\">' +","                    '<label for=\"{{elementid}}_{{CSS.INPUTURL}}\">{{get_string \"enterurl\" component}}</label>' +","                    '<div class=\"input-group input-append w-100\">' +","                        '<input class=\"form-control {{CSS.INPUTURL}}\" type=\"url\" ' +","                        'id=\"{{elementid}}_{{CSS.INPUTURL}}\" size=\"32\"/>' +","                        '<span class=\"input-group-append\">' +","                            '<button class=\"btn btn-secondary {{CSS.IMAGEBROWSER}}\" type=\"button\">' +","                            '{{get_string \"browserepositories\" component}}</button>' +","                        '</span>' +","                    '</div>' +","                '</div>' +","            '{{else}}' +","                '<div class=\"mb-1\">' +","                    '<label for=\"{{elementid}}_{{CSS.INPUTURL}}\">{{get_string \"enterurl\" component}}</label>' +","                    '<input class=\"form-control fullwidth {{CSS.INPUTURL}}\" type=\"url\" ' +","                    'id=\"{{elementid}}_{{CSS.INPUTURL}}\" size=\"32\"/>' +","                '</div>' +","            '{{/if}}' +","  ","            // Add the alignment selector.","            '<div class=\"form-inline mb-1\">' +","            '<label class=\"for=\"{{elementid}}_{{CSS.INPUTALIGNMENT}}\">{{get_string \"alignment\" component}}</label>' +","            '<select class=\"custom-select {{CSS.INPUTALIGNMENT}}\" id=\"{{elementid}}_{{CSS.INPUTALIGNMENT}}\">' +","                '{{#each alignments}}' +","                    '<option value=\"{{value}}\">{{get_string str ../component}}</option>' +","                '{{/each}}' +","            '</select>' +","            '</div>' +","            // Hidden input to store custom styles.","            '<input type=\"hidden\" class=\"{{CSS.INPUTCUSTOMSTYLE}}\"/>' +","            '<br/>' +","  ","            // Add the image preview.","            '<div class=\"mdl-align\">' +","            '<div class=\"{{CSS.IMAGEPREVIEWBOX}}\">' +","                '<img src=\"#\" class=\"{{CSS.IMAGEPREVIEW}}\" alt=\"\" style=\"display: none;\"/>' +","            '</div>' +","  ","            // Add the submit button and close the form.","            '<button class=\"btn btn-secondary {{CSS.INPUTSUBMIT}}\" type=\"submit\">' + '' +","                '{{get_string \"saveimage\" component}}</button>' +","            '</div>' +","        '</form>',","  ","  IMAGETEMPLATE = '' +","            '<img src=\"{{url}}\" alt=\"Responsive image\" ' +","                'class=\"attoresponsiveimage img-responsive\"' +","                '{{#if id}}id=\"{{id}}\" {{/if}}' +","                '/>';","  ","  Y.namespace('M.atto_responsiveimage').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","  /**","  * A reference to the current selection at the time that the dialogue","  * was opened.","  *","  * @property _currentSelection","  * @type Range","  * @private","  */","  _currentSelection: null,","  ","  /**","  * The most recently selected image.","  *","  * @param _selectedImage","  * @type Node","  * @private","  */","  _selectedImage: null,","  ","  /**","  * A reference to the currently open form.","  *","  * @param _attoform","  * @type Node","  * @private","  */","  _attoform: null,","  ","  /**","  * The dimensions of the raw image before we manipulate it.","  *","  * @param _rawImageDimensions","  * @type Object","  * @private","  */","  _rawImageDimensions: null,","  ","  initializer: function() {","  ","    this.addButton({","        icon: M.util.image_url(\"ed/\" + 'editor_responsiveimage',\"atto_responsiveimage\"),","        callback: this._displayDialogue,","        tags: '.attoresponsiveimage',","        tagMatchRequiresAll: false","    });","    this.editor.delegate('dblclick', this._displayDialogue, '.attoresponsiveimage', this);","    this.editor.delegate('click', this._handleClick, '.attoresponsiveimage', this);","    this.editor.on('drop', this._handleDragDrop, this);","  ","    // e.preventDefault needed to stop the default event from clobbering the desired behaviour in some browsers.","    this.editor.on('dragover', function(e) {","        e.preventDefault();","    }, this);","    this.editor.on('dragenter', function(e) {","        e.preventDefault();","    }, this);","  },","  ","  /**","  * Handle a drag and drop event with an image.","  *","  * @method _handleDragDrop","  * @param {EventFacade} e","  * @return mixed","  * @private","  */","  _handleDragDrop: function(e) {","  ","    var self = this,","        host = this.get('host'),","        template = Y.Handlebars.compile(IMAGETEMPLATE);","  ","    host.saveSelection();","    e = e._event;","  ","    // Only handle the event if an image file was dropped in.","    var handlesDataTransfer = (e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files.length);","    if (handlesDataTransfer && /^image\\//.test(e.dataTransfer.files[0].type)) {","  ","        var options = host.get('filepickeroptions').image,","            savepath = (options.savepath === undefined) ? '/' : options.savepath,","            formData = new FormData(),","            timestamp = 0,","            uploadid = \"\",","            xhr = new XMLHttpRequest(),","            imagehtml = \"\",","            keys = Object.keys(options.repositories);","  ","        e.preventDefault();","        e.stopPropagation();","        formData.append('repo_upload_file', e.dataTransfer.files[0]);","        formData.append('itemid', options.itemid);","  ","        // List of repositories is an object rather than an array.  This makes iteration more awkward.","        for (var i = 0; i < keys.length; i++) {","            if (options.repositories[keys[i]].type === 'upload') {","                formData.append('repo_id', options.repositories[keys[i]].id);","                break;","            }","        }","        formData.append('env', options.env);","        formData.append('sesskey', M.cfg.sesskey);","        formData.append('client_id', options.client_id);","        formData.append('savepath', savepath);","        formData.append('ctx_id', options.context.id);","  ","        // Insert spinner as a placeholder.","        timestamp = new Date().getTime();","        uploadid = 'moodleimage_' + Math.round(Math.random() * 100000) + '-' + timestamp;","        host.focus();","        host.restoreSelection();","        imagehtml = template({","            url: M.util.image_url(\"i/loading_small\", 'moodle'),","            alt: M.util.get_string('uploading', COMPONENTNAME),","            id: uploadid","        });","        host.insertContentAtFocusPoint(imagehtml);","        self.markUpdated();","  ","        // Kick off a XMLHttpRequest.","        xhr.onreadystatechange = function() {","            var placeholder = self.editor.one('#' + uploadid),","                result,","                file,","                newhtml,","                newimage;","  ","            if (xhr.readyState === 4) {","                if (xhr.status === 200) {","                    result = JSON.parse(xhr.responseText);","                    if (result) {","                        if (result.error) {","                            if (placeholder) {","                                placeholder.remove(true);","                            }","                            return new M.core.ajaxException(result);","                        }","  ","                        file = result;","                        if (result.event && result.event === 'fileexists') {","                            // A file with this name is already in use here - rename to avoid conflict.","                            // Chances are, it's a different image (stored in a different folder on the user's computer).","                            // If the user wants to reuse an existing image, they can copy/paste it within the editor.","                            file = result.newfile;","                        }","  ","                        // Replace placeholder with actual image.","                        newhtml = template({","                            url: file.url,","                            presentation: true","                        });","                        newimage = Y.Node.create(newhtml);","                        if (placeholder) {","                            placeholder.replace(newimage);","                        } else {","                            self.editor.appendChild(newimage);","                        }","                        self.markUpdated();","                    }","                } else {","                    Y.use('moodle-core-notification-alert', function() {","                        new M.core.alert({message: M.util.get_string('servererror', 'moodle')});","                    });","                    if (placeholder) {","                        placeholder.remove(true);","                    }","                }","            }","        };","        xhr.open(\"POST\", M.cfg.wwwroot + '/repository/repository_ajax.php?action=upload', true);","        xhr.send(formData);","        return false;","    }","  ","  },","  ","  /**","  * Handle a click on an image.","  *","  * @method _handleClick","  * @param {EventFacade} e","  * @private","  */","  _handleClick: function(e) {","    var image = e.target;","  ","    var selection = this.get('host').getSelectionFromNode(image);","    if (this.get('host').getSelection() !== selection) {","        this.get('host').setSelection(selection);","    }","  },","  ","  /**","  * Display the image editing tool.","  *","  * @method _displayDialogue","  * @private","  */","  _displayDialogue: function() {","    // Store the current selection.","    this._currentSelection = this.get('host').getSelection();","    if (this._currentSelection === false) {","        return;","    }","  ","    // Reset the image dimensions.","    this._rawImageDimensions = null;","  ","    var dialogue = this.getDialogue({","        headerContent: M.util.get_string('imageproperties', COMPONENTNAME),","        width: 'auto',","        focusAfterHide: true,","        focusOnShowSelector: SELECTORS.INPUTURL","    });","  ","    // Set the dialogue content, and then show the dialogue.","    dialogue.set('bodyContent', this._getDialogueContent())","            .show();","  },","  ","  /**","  * Set the inputs for width and height if they are not set, and calculate","  * if the constrain checkbox should be checked or not.","  *","  * @method _loadPreviewImage","  * @param {String} url","  * @private","  */","  _loadPreviewImage: function(url) {","    var image = new Image();","    var self = this;","  ","    image.onerror = function() {","        var preview = self._attoform.one('.' + CSS.IMAGEPREVIEW);","        preview.setStyles({","            'display': 'none'","        });","  ","        // Centre the dialogue when clearing the image preview.","        self.getDialogue().centerDialogue();","    };","  ","    image.onload = function() {","        var input, currentwidth, currentheight, widthRatio, heightRatio;","  ","        self._rawImageDimensions = {","            width: this.width,","            height: this.height","        };","  ","        input = self._attoform.one('.' + CSS.IMAGEPREVIEW);","        input.setAttribute('src', this.src);","        input.setStyles({","            'display': 'inline'","        });","  ","        self.getDialogue().centerDialogue();","    };","  ","    image.src = url;","  },","  ","  /**","  * Return the dialogue content for the tool, attaching any required","  * events.","  *","  * @method _getDialogueContent","  * @return {Node} The content to place in the dialogue.","  * @private","  */","  _getDialogueContent: function() {","    var template = Y.Handlebars.compile(TEMPLATE),","        canShowFilepicker = this.get('host').canShowFilepicker('image'),","        content = Y.Node.create(template({","            elementid: this.get('host').get('elementid'),","            CSS: CSS,","            component: COMPONENTNAME,","            showFilepicker: canShowFilepicker,","            alignments: ALIGNMENTS","        }));","   ","    this._attoform = content;","  ","    // Configure the view of the current image.","    this._applyImageProperties(this._attoform);","  ","    this._attoform.one('.' + CSS.INPUTURL).on('blur', this._urlChanged, this);","    this._attoform.one('.' + CSS.INPUTURL).on('blur', this._urlChanged, this);","    this._attoform.one('.' + CSS.INPUTSUBMIT).on('click', this._setImage, this);","  ","     if (canShowFilepicker) {","          content.delegate('click', function(e) {","              var element = this._attoform;","              e.preventDefault();","              this.get('host').showFilepicker('image', this._getFilepickerCallback(element), this);","          }, '.atto_responsiveimage_openimagebrowser', this);","     }","  ","    return content;","  },","  ","  /**","  * Update the dialogue after an image was selected in the File Picker.","  *","  * @method _filepickerCallback","  * @param {object} params The parameters provided by the filepicker","  * containing information about the image.","  * @private","  */","  _filepickerCallback: function(params) {","    if (params.url !== '') {","        var input = this._attoform.one('.' + CSS.INPUTURL);","        input.set('value', params.url);","  ","        // Load the preview image.","        this._loadPreviewImage(params.url);","    }","  },","  ","  /**","       * Returns the callback for the file picker to call after a file has been selected.","       *","       * @method _getFilepickerCallback","       * @param  {Y.Node} element The element which triggered the callback (atto form)","       * @return {Function} The function to be used as a callback when the file picker returns the file","       * @private","       */","      _getFilepickerCallback: function(element) {","          return function(params) {","              if (params.url !== '') {","                  var input = element.one('.' + CSS.INPUTURL);","                  input.set('value', params.url);","  ","                  // Load the preview image.","                  var image = new Image();","  ","                  image.onerror = function() {","                      var preview = element.one('.' + CSS.IMAGEPREVIEW);","                      preview.setStyles({","                          'display': 'none'","                      });","                  };","  ","                  image.onload = function() {","                      var input;","  ","                      input = element.one('.' + CSS.IMAGEPREVIEW);","                      input.setAttribute('src', this.src);","                      input.setStyles({","                          'display': 'inline'","                      });","  ","                  };","  ","                  image.src = params.url;","              }","          };","      },","  ","  /**","  * Applies properties of an existing image to the image dialogue for editing.","  *","  * @method _applyImageProperties","  * @param {Node} form","  * @private","  */","  _applyImageProperties: function(form) {","    var properties = this._getSelectedImageProperties(),","        img = form.one('.' + CSS.IMAGEPREVIEW);","  ","    if (properties === false) {","        img.setStyle('display', 'none');","        // Set the default alignment.","        ALIGNMENTS.some(function(alignment) {","            if (alignment.isDefault) {","                //form.one('.' + CSS.INPUTALIGNMENT).set('value', alignment.value);","                return true;","            }","  ","            return false;","        }, this);","  ","        return;","    }","  ","    if (properties.align) {","        form.one('.' + CSS.INPUTALIGNMENT).set('value', properties.align);","    }","    if (properties.customstyle) {","        form.one('.' + CSS.INPUTCUSTOMSTYLE).set('value', properties.customstyle);","    }","  ","    if (properties.src) {","        form.one('.' + CSS.INPUTURL).set('value', properties.src);","        this._loadPreviewImage(properties.src);","    }","  },","  ","  /**","  * Gets the properties of the currently selected image.","  *","  * The first image only if multiple images are selected.","  *","  * @method _getSelectedImageProperties","  * @return {object}","  * @private","  */","  _getSelectedImageProperties: function() {","    var properties = {","            src: null,","            alt: null,","            align: '',","            presentation: false","        },","  ","        // Get the current selection.","        images = this.get('host').getSelectedNodes(),","        style,","        image;","  ","    if (images) {","        images = images.filter('img');","    }","  ","    if (images && images.size()) {","        image = this._removeLegacyAlignment(images.item(0));","        this._selectedImage = image;","  ","        style = image.getAttribute('style');","        properties.customstyle = style;","  ","        this._getAlignmentPropeties(image, properties);","        properties.src = image.getAttribute('src');","        properties.presentation = (image.get('role') === 'presentation');","        return properties;","    }","  ","    // No image selected - clean up.","    this._selectedImage = null;","    return false;","  },","  ","  /**","  * Sets the alignment of a properties object.","  *","  * @method _getAlignmentPropeties","  * @param {Node} image The image that the alignment properties should be found for","  * @param {Object} properties The properties object that is created in _getSelectedImageProperties()","  * @private","  */","  _getAlignmentPropeties: function(image, properties) {","    var complete = false,","        defaultAlignment;","  ","    // Check for an alignment value.","    complete = ALIGNMENTS.some(function(alignment) {","        var classname = this._getAlignmentClass(alignment.value);","        if (image.hasClass(classname)) {","            properties.align = alignment.value;","  ","            return true;","        }","  ","        if (alignment.isDefault) {","            defaultAlignment = alignment.value;","        }","  ","        return false;","    }, this);","  ","    if (!complete && defaultAlignment) {","        properties.align = defaultAlignment;","    }","  },","  ","  /**","  * Update the form when the URL was changed. This includes updating the","  * height, width, and image preview.","  *","  * @method _urlChanged","  * @private","  */","  _urlChanged: function() {","    var input = this._attoform.one('.' + CSS.INPUTURL);","  ","    if (input.get('value') !== '') {","        // Load the preview image.","        this._loadPreviewImage(input.get('value'));","    }","  },","  ","  /**","  * Update the image in the contenteditable.","  *","  * @method _setImage","  * @param {EventFacade} e","  * @private","  */","  _setImage: function(e) {","    var form = this._attoform,","        url = form.one('.' + CSS.INPUTURL).get('value'),","        alignment = this._getAlignmentClass(form.one('.' + CSS.INPUTALIGNMENT).get('value')),","        imagehtml,","        customstyle = form.one('.' + CSS.INPUTCUSTOMSTYLE).get('value'),","        classlist = [],","        host = this.get('host');","  ","    e.preventDefault();","  ","    // Check if there are any accessibility issues.","    if (this._updateWarning()) {","        return;","    }","  ","    // Focus on the editor in preparation for inserting the image.","    host.focus();","    if (url !== '') {","        if (this._selectedImage) {","            host.setSelection(host.getSelectionFromNode(this._selectedImage));","        } else {","            host.setSelection(this._currentSelection);","        }","  ","        // Add the alignment class for the image.","        classlist.push(alignment);","  ","        var template = Y.Handlebars.compile(IMAGETEMPLATE);","        imagehtml = template({","            url: url,","            customstyle: customstyle,","            classlist: classlist.join(' ')","        });","  ","        this.get('host').insertContentAtFocusPoint(imagehtml);","  ","        this.markUpdated();","    }","  ","    this.getDialogue({","      focusAfterHide: null","    }).hide();","  ","  },","  ","  /**","  * Removes any legacy styles added by previous versions of the atto image button.","  *","  * @method _removeLegacyAlignment","  * @param {Y.Node} imageNode","  * @return {Y.Node}","  * @private","  */","  _removeLegacyAlignment: function(imageNode) {","    if (!imageNode.getStyle('margin')) {","        // There is no margin therefore this cannot match any known alignments.","        return imageNode;","    }","  ","    ALIGNMENTS.some(function(alignment) {","        if (imageNode.getStyle(alignment.name) !== alignment.value) {","            // The name/value do not match. Skip.","            return false;","        }","  ","        var normalisedNode = Y.Node.create('<div>');","        normalisedNode.setStyle('margin', alignment.margin);","        if (imageNode.getStyle('margin') !== normalisedNode.getStyle('margin')) {","            // The margin does not match.","            return false;","        }","  ","        imageNode.addClass(this._getAlignmentClass(alignment.value));","        imageNode.setStyle(alignment.name, null);","        imageNode.setStyle('margin', null);","  ","        return true;","    }, this);","  ","    return imageNode;","  },","  ","  _getAlignmentClass: function(alignment) {","    return CSS.ALIGNSETTINGS + '_' + alignment;","  },","  ","  /**","  * Update the alt text warning live.","  *","  * @method _updateWarning","  * @return {boolean} whether a warning should be displayed.","  * @private","  */","  _updateWarning: function() {","          return false;","  }","  });","  ","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
__cov_KvEaIzhEyUKJ2_d3Ygivgg = __cov_KvEaIzhEyUKJ2_d3Ygivgg['build/moodle-atto_responsiveimage-button/moodle-atto_responsiveimage-button.js'];
__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['1']++;YUI.add('moodle-atto_responsiveimage-button',function(Y,NAME){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['1']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['2']++;var CSS={RESPONSIVE:'img-responsive',INPUTALIGNMENT:'atto_responsiveimage_alignment',INPUTALT:'atto_responsiveimage_altentry',INPUTHEIGHT:'atto_responsiveimage_heightentry',INPUTSUBMIT:'atto_responsiveimage_urlentrysubmit',INPUTURL:'atto_responsiveimage_urlentry',INPUTSIZE:'atto_responsiveimage_size',INPUTWIDTH:'atto_responsiveimage_widthentry',IMAGEALTWARNING:'atto_responsiveimage_altwarning',IMAGEBROWSER:'atto_responsiveimage_openimagebrowser',IMAGEPRESENTATION:'atto_responsiveimage_presentation',INPUTCONSTRAIN:'atto_responsiveimage_constrain',INPUTCUSTOMSTYLE:'atto_responsiveimage_customstyle',IMAGEPREVIEW:'atto_responsiveimage_preview',IMAGEPREVIEWBOX:'atto_responsiveimage_preview_box',ALIGNSETTINGS:'atto_responsiveimage_button'},SELECTORS={INPUTURL:'.'+CSS.INPUTURL},ALIGNMENTS=[{name:'verticalAlign',str:'alignment_top',value:'text-top',margin:'0 0.5em'}],REGEX={ISPERCENT:/\d+%/},COMPONENTNAME='atto_responsiveimage',TEMPLATE=''+'<form class="atto_attoform">'+'{{#if showFilepicker}}'+'<div class="mb-1">'+'<label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label>'+'<div class="input-group input-append w-100">'+'<input class="form-control {{CSS.INPUTURL}}" type="url" '+'id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/>'+'<span class="input-group-append">'+'<button class="btn btn-secondary {{CSS.IMAGEBROWSER}}" type="button">'+'{{get_string "browserepositories" component}}</button>'+'</span>'+'</div>'+'</div>'+'{{else}}'+'<div class="mb-1">'+'<label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label>'+'<input class="form-control fullwidth {{CSS.INPUTURL}}" type="url" '+'id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/>'+'</div>'+'{{/if}}'+'<div class="form-inline mb-1">'+'<label class="for="{{elementid}}_{{CSS.INPUTALIGNMENT}}">{{get_string "alignment" component}}</label>'+'<select class="custom-select {{CSS.INPUTALIGNMENT}}" id="{{elementid}}_{{CSS.INPUTALIGNMENT}}">'+'{{#each alignments}}'+'<option value="{{value}}">{{get_string str ../component}}</option>'+'{{/each}}'+'</select>'+'</div>'+'<input type="hidden" class="{{CSS.INPUTCUSTOMSTYLE}}"/>'+'<br/>'+'<div class="mdl-align">'+'<div class="{{CSS.IMAGEPREVIEWBOX}}">'+'<img src="#" class="{{CSS.IMAGEPREVIEW}}" alt="" style="display: none;"/>'+'</div>'+'<button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">'+''+'{{get_string "saveimage" component}}</button>'+'</div>'+'</form>',IMAGETEMPLATE=''+'<img src="{{url}}" alt="Responsive image" '+'class="attoresponsiveimage img-responsive"'+'{{#if id}}id="{{id}}" {{/if}}'+'/>';__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['3']++;Y.namespace('M.atto_responsiveimage').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_selectedImage:null,_attoform:null,_rawImageDimensions:null,initializer:function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['2']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['4']++;this.addButton({icon:M.util.image_url('ed/'+'editor_responsiveimage','atto_responsiveimage'),callback:this._displayDialogue,tags:'.attoresponsiveimage',tagMatchRequiresAll:false});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['5']++;this.editor.delegate('dblclick',this._displayDialogue,'.attoresponsiveimage',this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['6']++;this.editor.delegate('click',this._handleClick,'.attoresponsiveimage',this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['7']++;this.editor.on('drop',this._handleDragDrop,this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['8']++;this.editor.on('dragover',function(e){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['3']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['9']++;e.preventDefault();},this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['10']++;this.editor.on('dragenter',function(e){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['4']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['11']++;e.preventDefault();},this);},_handleDragDrop:function(e){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['5']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['12']++;var self=this,host=this.get('host'),template=Y.Handlebars.compile(IMAGETEMPLATE);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['13']++;host.saveSelection();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['14']++;e=e._event;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['15']++;var handlesDataTransfer=(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['1'][0]++,e.dataTransfer)&&(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['1'][1]++,e.dataTransfer.files)&&(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['1'][2]++,e.dataTransfer.files.length);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['16']++;if((__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['3'][0]++,handlesDataTransfer)&&(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['3'][1]++,/^image\//.test(e.dataTransfer.files[0].type))){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['2'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['17']++;var options=host.get('filepickeroptions').image,savepath=options.savepath===undefined?(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['4'][0]++,'/'):(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['4'][1]++,options.savepath),formData=new FormData(),timestamp=0,uploadid='',xhr=new XMLHttpRequest(),imagehtml='',keys=Object.keys(options.repositories);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['18']++;e.preventDefault();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['19']++;e.stopPropagation();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['20']++;formData.append('repo_upload_file',e.dataTransfer.files[0]);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['21']++;formData.append('itemid',options.itemid);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['22']++;for(var i=0;i<keys.length;i++){__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['23']++;if(options.repositories[keys[i]].type==='upload'){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['5'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['24']++;formData.append('repo_id',options.repositories[keys[i]].id);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['25']++;break;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['5'][1]++;}}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['26']++;formData.append('env',options.env);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['27']++;formData.append('sesskey',M.cfg.sesskey);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['28']++;formData.append('client_id',options.client_id);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['29']++;formData.append('savepath',savepath);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['30']++;formData.append('ctx_id',options.context.id);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['31']++;timestamp=new Date().getTime();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['32']++;uploadid='moodleimage_'+Math.round(Math.random()*100000)+'-'+timestamp;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['33']++;host.focus();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['34']++;host.restoreSelection();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['35']++;imagehtml=template({url:M.util.image_url('i/loading_small','moodle'),alt:M.util.get_string('uploading',COMPONENTNAME),id:uploadid});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['36']++;host.insertContentAtFocusPoint(imagehtml);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['37']++;self.markUpdated();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['38']++;xhr.onreadystatechange=function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['6']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['39']++;var placeholder=self.editor.one('#'+uploadid),result,file,newhtml,newimage;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['40']++;if(xhr.readyState===4){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['6'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['41']++;if(xhr.status===200){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['7'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['42']++;result=JSON.parse(xhr.responseText);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['43']++;if(result){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['8'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['44']++;if(result.error){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['9'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['45']++;if(placeholder){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['10'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['46']++;placeholder.remove(true);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['10'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['47']++;return new M.core.ajaxException(result);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['9'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['48']++;file=result;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['49']++;if((__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['12'][0]++,result.event)&&(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['12'][1]++,result.event==='fileexists')){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['11'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['50']++;file=result.newfile;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['11'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['51']++;newhtml=template({url:file.url,presentation:true});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['52']++;newimage=Y.Node.create(newhtml);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['53']++;if(placeholder){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['13'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['54']++;placeholder.replace(newimage);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['13'][1]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['55']++;self.editor.appendChild(newimage);}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['56']++;self.markUpdated();}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['8'][1]++;}}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['7'][1]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['57']++;Y.use('moodle-core-notification-alert',function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['7']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['58']++;new M.core.alert({message:M.util.get_string('servererror','moodle')});});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['59']++;if(placeholder){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['14'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['60']++;placeholder.remove(true);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['14'][1]++;}}}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['6'][1]++;}};__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['61']++;xhr.open('POST',M.cfg.wwwroot+'/repository/repository_ajax.php?action=upload',true);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['62']++;xhr.send(formData);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['63']++;return false;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['2'][1]++;}},_handleClick:function(e){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['8']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['64']++;var image=e.target;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['65']++;var selection=this.get('host').getSelectionFromNode(image);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['66']++;if(this.get('host').getSelection()!==selection){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['15'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['67']++;this.get('host').setSelection(selection);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['15'][1]++;}},_displayDialogue:function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['9']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['68']++;this._currentSelection=this.get('host').getSelection();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['69']++;if(this._currentSelection===false){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['16'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['70']++;return;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['16'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['71']++;this._rawImageDimensions=null;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['72']++;var dialogue=this.getDialogue({headerContent:M.util.get_string('imageproperties',COMPONENTNAME),width:'auto',focusAfterHide:true,focusOnShowSelector:SELECTORS.INPUTURL});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['73']++;dialogue.set('bodyContent',this._getDialogueContent()).show();},_loadPreviewImage:function(url){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['10']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['74']++;var image=new Image();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['75']++;var self=this;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['76']++;image.onerror=function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['11']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['77']++;var preview=self._attoform.one('.'+CSS.IMAGEPREVIEW);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['78']++;preview.setStyles({'display':'none'});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['79']++;self.getDialogue().centerDialogue();};__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['80']++;image.onload=function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['12']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['81']++;var input,currentwidth,currentheight,widthRatio,heightRatio;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['82']++;self._rawImageDimensions={width:this.width,height:this.height};__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['83']++;input=self._attoform.one('.'+CSS.IMAGEPREVIEW);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['84']++;input.setAttribute('src',this.src);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['85']++;input.setStyles({'display':'inline'});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['86']++;self.getDialogue().centerDialogue();};__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['87']++;image.src=url;},_getDialogueContent:function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['13']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['88']++;var template=Y.Handlebars.compile(TEMPLATE),canShowFilepicker=this.get('host').canShowFilepicker('image'),content=Y.Node.create(template({elementid:this.get('host').get('elementid'),CSS:CSS,component:COMPONENTNAME,showFilepicker:canShowFilepicker,alignments:ALIGNMENTS}));__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['89']++;this._attoform=content;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['90']++;this._applyImageProperties(this._attoform);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['91']++;this._attoform.one('.'+CSS.INPUTURL).on('blur',this._urlChanged,this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['92']++;this._attoform.one('.'+CSS.INPUTURL).on('blur',this._urlChanged,this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['93']++;this._attoform.one('.'+CSS.INPUTSUBMIT).on('click',this._setImage,this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['94']++;if(canShowFilepicker){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['17'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['95']++;content.delegate('click',function(e){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['14']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['96']++;var element=this._attoform;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['97']++;e.preventDefault();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['98']++;this.get('host').showFilepicker('image',this._getFilepickerCallback(element),this);},'.atto_responsiveimage_openimagebrowser',this);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['17'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['99']++;return content;},_filepickerCallback:function(params){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['15']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['100']++;if(params.url!==''){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['18'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['101']++;var input=this._attoform.one('.'+CSS.INPUTURL);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['102']++;input.set('value',params.url);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['103']++;this._loadPreviewImage(params.url);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['18'][1]++;}},_getFilepickerCallback:function(element){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['16']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['104']++;return function(params){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['17']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['105']++;if(params.url!==''){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['19'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['106']++;var input=element.one('.'+CSS.INPUTURL);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['107']++;input.set('value',params.url);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['108']++;var image=new Image();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['109']++;image.onerror=function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['18']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['110']++;var preview=element.one('.'+CSS.IMAGEPREVIEW);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['111']++;preview.setStyles({'display':'none'});};__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['112']++;image.onload=function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['19']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['113']++;var input;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['114']++;input=element.one('.'+CSS.IMAGEPREVIEW);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['115']++;input.setAttribute('src',this.src);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['116']++;input.setStyles({'display':'inline'});};__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['117']++;image.src=params.url;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['19'][1]++;}};},_applyImageProperties:function(form){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['20']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['118']++;var properties=this._getSelectedImageProperties(),img=form.one('.'+CSS.IMAGEPREVIEW);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['119']++;if(properties===false){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['20'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['120']++;img.setStyle('display','none');__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['121']++;ALIGNMENTS.some(function(alignment){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['21']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['122']++;if(alignment.isDefault){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['21'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['123']++;return true;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['21'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['124']++;return false;},this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['125']++;return;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['20'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['126']++;if(properties.align){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['22'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['127']++;form.one('.'+CSS.INPUTALIGNMENT).set('value',properties.align);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['22'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['128']++;if(properties.customstyle){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['23'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['129']++;form.one('.'+CSS.INPUTCUSTOMSTYLE).set('value',properties.customstyle);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['23'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['130']++;if(properties.src){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['24'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['131']++;form.one('.'+CSS.INPUTURL).set('value',properties.src);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['132']++;this._loadPreviewImage(properties.src);}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['24'][1]++;}},_getSelectedImageProperties:function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['22']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['133']++;var properties={src:null,alt:null,align:'',presentation:false},images=this.get('host').getSelectedNodes(),style,image;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['134']++;if(images){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['25'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['135']++;images=images.filter('img');}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['25'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['136']++;if((__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['27'][0]++,images)&&(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['27'][1]++,images.size())){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['26'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['137']++;image=this._removeLegacyAlignment(images.item(0));__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['138']++;this._selectedImage=image;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['139']++;style=image.getAttribute('style');__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['140']++;properties.customstyle=style;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['141']++;this._getAlignmentPropeties(image,properties);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['142']++;properties.src=image.getAttribute('src');__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['143']++;properties.presentation=image.get('role')==='presentation';__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['144']++;return properties;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['26'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['145']++;this._selectedImage=null;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['146']++;return false;},_getAlignmentPropeties:function(image,properties){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['23']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['147']++;var complete=false,defaultAlignment;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['148']++;complete=ALIGNMENTS.some(function(alignment){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['24']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['149']++;var classname=this._getAlignmentClass(alignment.value);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['150']++;if(image.hasClass(classname)){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['28'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['151']++;properties.align=alignment.value;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['152']++;return true;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['28'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['153']++;if(alignment.isDefault){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['29'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['154']++;defaultAlignment=alignment.value;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['29'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['155']++;return false;},this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['156']++;if((__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['31'][0]++,!complete)&&(__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['31'][1]++,defaultAlignment)){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['30'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['157']++;properties.align=defaultAlignment;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['30'][1]++;}},_urlChanged:function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['25']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['158']++;var input=this._attoform.one('.'+CSS.INPUTURL);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['159']++;if(input.get('value')!==''){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['32'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['160']++;this._loadPreviewImage(input.get('value'));}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['32'][1]++;}},_setImage:function(e){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['26']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['161']++;var form=this._attoform,url=form.one('.'+CSS.INPUTURL).get('value'),alignment=this._getAlignmentClass(form.one('.'+CSS.INPUTALIGNMENT).get('value')),imagehtml,customstyle=form.one('.'+CSS.INPUTCUSTOMSTYLE).get('value'),classlist=[],host=this.get('host');__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['162']++;e.preventDefault();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['163']++;if(this._updateWarning()){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['33'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['164']++;return;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['33'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['165']++;host.focus();__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['166']++;if(url!==''){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['34'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['167']++;if(this._selectedImage){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['35'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['168']++;host.setSelection(host.getSelectionFromNode(this._selectedImage));}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['35'][1]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['169']++;host.setSelection(this._currentSelection);}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['170']++;classlist.push(alignment);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['171']++;var template=Y.Handlebars.compile(IMAGETEMPLATE);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['172']++;imagehtml=template({url:url,customstyle:customstyle,classlist:classlist.join(' ')});__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['173']++;this.get('host').insertContentAtFocusPoint(imagehtml);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['174']++;this.markUpdated();}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['34'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['175']++;this.getDialogue({focusAfterHide:null}).hide();},_removeLegacyAlignment:function(imageNode){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['27']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['176']++;if(!imageNode.getStyle('margin')){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['36'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['177']++;return imageNode;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['36'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['178']++;ALIGNMENTS.some(function(alignment){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['28']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['179']++;if(imageNode.getStyle(alignment.name)!==alignment.value){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['37'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['180']++;return false;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['37'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['181']++;var normalisedNode=Y.Node.create('<div>');__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['182']++;normalisedNode.setStyle('margin',alignment.margin);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['183']++;if(imageNode.getStyle('margin')!==normalisedNode.getStyle('margin')){__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['38'][0]++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['184']++;return false;}else{__cov_KvEaIzhEyUKJ2_d3Ygivgg.b['38'][1]++;}__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['185']++;imageNode.addClass(this._getAlignmentClass(alignment.value));__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['186']++;imageNode.setStyle(alignment.name,null);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['187']++;imageNode.setStyle('margin',null);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['188']++;return true;},this);__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['189']++;return imageNode;},_getAlignmentClass:function(alignment){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['29']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['190']++;return CSS.ALIGNSETTINGS+'_'+alignment;},_updateWarning:function(){__cov_KvEaIzhEyUKJ2_d3Ygivgg.f['30']++;__cov_KvEaIzhEyUKJ2_d3Ygivgg.s['191']++;return false;}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});
